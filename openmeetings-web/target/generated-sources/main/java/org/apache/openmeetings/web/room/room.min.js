/*
 NoSleep.js v0.11.0 - git.io/vfn01 - Rich Tibbett - MIT license */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,u){a!=Array.prototype&&a!=Object.prototype&&(a[e]=u.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var e=a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var e,u=[];!(e=a.next()).done;)u.push(e.value);return u};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
(function(a,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports.NoSleep=e():a.NoSleep=e()})(window,function(){return function(a){function e(q){if(u[q])return u[q].exports;var m=u[q]={i:q,l:!1,exports:{}};a[q].call(m.exports,m,m.exports,e);m.l=!0;return m.exports}var u={};e.m=a;e.c=u;e.d=function(a,m,w){e.o(a,m)||Object.defineProperty(a,m,{enumerable:!0,get:w})};e.r=function(a){$jscomp.initSymbol();
$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(a,"__esModule",{value:!0})};e.t=function(a,m){m&1&&(a=e(a));if(m&8||m&4&&"object"===typeof a&&a&&a.__esModule)return a;var q=Object.create(null);e.r(q);Object.defineProperty(q,"default",{enumerable:!0,value:a});if(m&2&&"string"!=typeof a)for(var h in a)e.d(q,h,function(e){return a[e]}.bind(null,h));return q};e.n=function(a){var m=
a&&a.__esModule?function(){return a["default"]}:function(){return a};e.d(m,"a",m);return m};e.o=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};e.p="";return e(e.s=0)}([function(a,e,u){var q=function(){function a(a,e){for(var g=0;g<e.length;g++){var l=e[g];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(a,l.key,l)}}return function(e,h,g){h&&a(e.prototype,h);g&&a(e,g);return e}}();e=u(1);var m=e.webm,w=e.mp4,h="undefined"!==typeof navigator&&
10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream,y="wakeLock"in navigator;e=function(){function a(){var e=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(y){this._wakeLock=null;var x=function(){null!==e._wakeLock&&"visible"===document.visibilityState&&e.enable()};document.addEventListener("visibilitychange",
x);document.addEventListener("fullscreenchange",x)}else h?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",m),this._addSourceToVideo(this.noSleepVideo,"mp4",w),this.noSleepVideo.addEventListener("loadedmetadata",function(){1>=e.noSleepVideo.duration?e.noSleepVideo.setAttribute("loop",""):e.noSleepVideo.addEventListener("timeupdate",
function(){.5<e.noSleepVideo.currentTime&&(e.noSleepVideo.currentTime=Math.random())})}))}q(a,[{key:"_addSourceToVideo",value:function(a,e,g){var l=document.createElement("source");l.src=g;l.type="video/"+e;a.appendChild(l)}},{key:"enable",value:function(){var a=this;y?navigator.wakeLock.request("screen").then(function(e){a._wakeLock=e;console.log("Wake Lock active.");a._wakeLock.addEventListener("release",function(){console.log("Wake Lock released.")})}).catch(function(a){console.error(a.name+", "+
a.message)}):h?(this.disable(),console.warn("\n        NoSleep enabled for older iOS devices. This can interrupt\n        active or long-running network requests from completing successfully.\n        See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n      "),this.noSleepTimer=window.setInterval(function(){document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){y?
(this._wakeLock.release(),this._wakeLock=null):h?this.noSleepTimer&&(console.warn("\n          NoSleep now disabled for older iOS devices.\n        "),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return a}();a.exports=e},function(a,e,u){a.exports={webm:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA\x3d",
mp4:"data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQAD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\x3d"}}])});
var Activities=function(){function a(){var a=Settings.load();"undefined"===typeof a.activity&&(a.activity={});return a}function e(a,b){a=!0===a.activity.clean;b.prop("checked",a);a&&g.find(".auto-clean").each(function(){setTimeout(C.bind(null,$(this).data().id),1E4)})}function u(a){Room.setCssVar("--activities-height",a)}function q(){24>g.height()&&($(".control.block i",g).removeClass("fa-angle-up").addClass("fa-angle-down"),$(".control.block",g).removeClass("bg-warning"),g.animate({height:t,top:"-"+
t},1E3,function(){g.css({top:""});u(t);g.resizable("option","disabled",!1)}))}function m(){24>g.height()||($(".control.block i",g).removeClass("fa-angle-down").addClass("fa-angle-up"),g.animate({height:20,top:c-20+"px"},1E3,function(){g.css({top:""});u("20px")}),g.resizable("option","disabled",!0))}function w(a){a=$("#user"+a);if(1===a.length){a[0].scrollIntoView();a.addClass("bg-warning");for(var b=0;10>b;b++)a.animate({marginTop:"-\x3d5px"},50).animate({marginTop:"+\x3d5px"},50);a.removeClass("bg-warning",
1500)}}function h(a){if(G&&24>g.height()&&($(".control.block",g).addClass("bg-warning"),window===window.parent&&a)){var b=function(){new Notification(d,{tag:"new_aa_item"})};"granted"===Notification.permission?b():"denied"!==Notification.permission&&Notification.requestPermission().then(function(a){"granted"===a&&b()})}}function y(a,b){activityAction($(".room-block .room-container").data("room-id"),a,b)}function A(a){for(var b=0;b<a.length;++b)$("#activity-"+a[b]).remove();x()}function C(a){l.prop("checked")&&
A([a])}function x(){G&&$(".control.block .badge",g).text(D.find(".activity").length)}var g,l,D,b,c=345,t=c+"px",G=!1,d;return{init:function(){if(void 0===$("#activities").resizable("instance")){g=$("#activities");var p=g.find(".control.block");p.off().click(Activities.toggle);d=p.data("new-aa");g.resizable({handles:"n",disabled:24>g.height(),minHeight:195,stop:function(a,b){c=b.size.height;t=c+"px";u(t);g.css({top:""})}});D=g.find(".area .actions");b=g.find(".area .activities");l=$("#activity-auto-clean");
l.change(function(){var b=a();b.activity.clean=$(this).prop("checked");Settings.save(b);e(b,$(this))});e(a(),l);G=!0;x()}},toggle:function(){G&&(24>g.height()?q():m())},findUser:w,add:function(a){if(G){var d="activity-"+a.id;(a.action?D:b).append(OmUtil.tmpl("#activity-stub",d).data(a));var d=$("#"+d).addClass(a.cssClass),c=d.find(".activity-accept");a.accept?c.click(function(){y("accept",a.id)}):c.remove();c=d.find(".activity-decline");a.decline?c.click(function(){y("decline",a.id)}):c.remove();
c=d.find(".activity-find");a.find?c.click(function(){w(a.uid)}):c.remove();d.find(".activity-close").click(function(){y("close",a.id)});d.find(".activity-text").text(a.text);h(a.action);l.prop("checked")&&d.hasClass("auto-clean")&&setTimeout(C.bind(null,a.id),1E4);x()}},remove:A}}(),Video=function(){function a(a){return(a=c.video(a))&&0<a.length?a[0]:null}function e(a){a!==P&&(P=a,OmUtil.sendMessage({type:"mic",id:"activity",active:a}))}function u(a,b,c){var f=kurentoUtils.WebRtcPeer.browser;if(VideoUtil.isEdge(f)&&
16<f.major){var v={video:!0};var k=navigator.getDisplayMedia(v)}else"Firefox"===f.name?(v=Sharer.baseConstraints(d),v.video.mediaSource=d.shareType,k=navigator.mediaDevices.getUserMedia(v)):VideoUtil.sharingSupported()?(v={video:!0},k=navigator.mediaDevices.getDisplayMedia(v)):k=new Promise(function(){Sharer.close();throw"Screen-sharing is not supported in "+f.name+"["+f.major+"]";});k.then(function(f){b.disposed||(g(b),b.stream=f,c(a,b,v))}).catch(function(f){VideoManager.sendMessage({id:"errorSharing"});
Sharer.setShareState(SHARE_STOPPED);Sharer.setRecState(SHARE_STOPPED);OmUtil.error(f)})}function q(a,b,c){VideoSettings.constraints(d,function(f){(VideoUtil.hasCam(d)&&!f.video||VideoUtil.hasMic(d)&&!f.audio)&&VideoManager.sendMessage({id:"devicesAltered",uid:d.uid,audio:!!f.audio,video:!!f.video});f.audio||f.video?navigator.mediaDevices.getUserMedia(f).then(function(v){if(!b.disposed&&a.instanceUid===p.data("instance-uid")){var k=b.localStream=v,d={};0!==v.getAudioTracks().length&&(J=B.find(".level-meter"),
J.show(),d.aCtx=new G,d.gainNode=d.aCtx.createGain(),d.analyser=d.aCtx.createAnalyser(),d.aSrc=d.aCtx.createMediaStreamSource(v),d.aSrc.connect(d.gainNode),d.gainNode.connect(d.analyser),VideoUtil.isEdge()?d.analyser.connect(d.aCtx.destination):(d.aDest=d.aCtx.createMediaStreamDestination(),d.analyser.connect(d.aDest),k=d.aDest.stream,v.getVideoTracks().forEach(function(f){k.addTrack(f)})));b.data=d;g(b);b.stream=k;c(a,b,f)}}).catch(function(f){VideoManager.sendMessage({id:"devicesAltered",uid:d.uid,
audio:!1,video:!1});VideoManager.close(d.uid);"NotReadableError"===f.name?OmUtil.error("Camera/Microphone is busy and can't be used"):OmUtil.error(f)}):(OmUtil.error("Requested devices are not available"),VideoManager.close(d.uid))})}function m(a){if(!a.disposed&&a.data.rtcPeer){var b=a.data.rtcPeer.peerConnection;b.onconnectionstatechange=function(a){console.warn("!!RTCPeerConnection state changed: "+b.connectionState+", user: "+d.user.displayName+", uid: "+d.uid);switch(b.connectionState){case "connected":d.self&&
OmUtil.alert("info","Connection to Media server has been established",3E3);break;case "disconnected":case "failed":OmUtil.alert("warning","Media server connection for user "+d.user.displayName+" is "+b.connectionState+", will try to re-connect",3E3),l()}}}}function w(b,r,H){r.options={videoStream:r.stream,mediaConstraints:H,onicecandidate:c.onIceCandidate};n||(r.options.localVideo=a(r));var f=r.data;f.rtcPeer=new kurentoUtils.WebRtcPeer.WebRtcPeerSendonly(VideoUtil.addIceServers(r.options,b),function(a){if(!r.disposed&&
!0!==f.rtcPeer.cleaned){if(a)return OmUtil.error(a);f.analyser&&(M=MicLevel(),M.meter(f.analyser,J,e,OmUtil.error));f.rtcPeer.generateOffer(function(a,b){if(!r.disposed&&!0!==f.rtcPeer.cleaned){if(a)return OmUtil.error("Sender sdp offer error "+a);OmUtil.log("Invoking Sender SDP offer callback function");a={id:"broadcastStarted",uid:d.uid,sdpOffer:b};(b=r.stream.getVideoTracks())&&0<b.length&&(b=b[0].getSettings(),a.width=b.width,a.height=b.height,a.fps=b.frameRate);VideoManager.sendMessage(a);n&&
Sharer.setShareState(SHARE_STARTED);L&&Sharer.setRecState(SHARE_STARTED)}})}});f.rtcPeer.cleaned=!1;m(r)}function h(b,r){g(r);b=VideoUtil.addIceServers({remoteVideo:a(r),onicecandidate:c.onIceCandidate},b);var k=r.data;k.rtcPeer=new kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(b,function(f){if(!r.disposed&&!0!==k.rtcPeer.cleaned){if(f)return OmUtil.error(f);k.rtcPeer.generateOffer(function(f,a){if(!r.disposed&&!0!==k.rtcPeer.cleaned){if(f)return OmUtil.error("Receiver sdp offer error "+f);OmUtil.log("Invoking Receiver SDP offer callback function");
VideoManager.sendMessage({id:"addListener",sender:d.uid,sdpOffer:a})}})}});k.rtcPeer.cleaned=!1;m(r)}function y(a){E&&E.is(":visible")&&(a?(E.text(E.data("on")),E.addClass("mic-on"),K.addClass("mic-on")):(E.text(E.data("off")),E.removeClass("mic-on"),K.removeClass("mic-on")))}function A(a,b){if(b.interview)a.dialog("option","draggable",!1),a.dialog("option","resizable",!1),$(".pod-area").sortable("refresh");else if(a.dialog("option","draggable",!0),a.dialog("option","resizable",!0),n)a.on("dialogclose",
function(){VideoManager.close(d.uid,!0)});C(b)}function C(a){function b(f){f.dblclick(function(f){f.stopImmediatePropagation();return!1})}p.parent().find(".ui-dialog-titlebar-close").remove();p.parent().append(OmUtil.tmpl("#video-button-bar"));var d=p.parent().find(".btn-refresh"),f=p.parent().find(".btn-toggle"),v=p.parent().find(".btn-wclose");n?(v.click(function(f){p.dialog("close");return!1}),b(v),d.remove()):(v.remove(),d.click(function(f){f.stopImmediatePropagation();l();return!1}));a.interview?
f.remove():(f.click(function(f){f.stopImmediatePropagation();$(this).toggleClass("minimized");p.toggle();return!1}),b(f))}function x(a){d=a.stream;a.instanceUid=uuidv4();I||(I=Volume());O=a.iceServers;d.activities=d.activities.sort();n=VideoUtil.isSharing(d);L=VideoUtil.isRecording(d);var k=VideoUtil.getVid(d.uid),e=d.user.displayName,f=d.width,v=d.height,t=Room.getOptions();d.self=d.cuid===t.uid;var g=a.instanceUid,h="#user"+d.cuid,m=VideoUtil.hasVideo(d);N={width:m?d.width:120,height:m?d.height:
90};if(F=m||1>$(h).length)if(t.interview){var m=$(".pod-area"),q=uuidv4(),h="#"+q;m.append($('\x3cdiv class\x3d"pod"\x3e\x3c/div\x3e').attr("id",q));WbArea.updateAreaClass()}else h=".room-block .room-container";$(h).append(OmUtil.tmpl("#user-video",k).attr("title",e).attr("data-client-uid",d.cuid).attr("data-client-type",d.type).attr("data-instance-uid",g).data(c));p=$("#"+k);B=p.find(".video");z=B.find(".mute-others");D();k=h;E=p.find(".footer");t.showMicStatus||E.hide();!d.self&&n&&Sharer.close();
d.self&&(n||L)?p.hide():F&&(p.dialog({classes:{"ui-dialog":"video user-video"+(t.showMicStatus?" mic-status":""),"ui-dialog-titlebar":""+(t.showMicStatus?" ui-state-highlight":"")},width:f,minWidth:40,minHeight:50,autoOpen:!0,modal:!1,appendTo:k}),A(p,t));K=p.parent().find(".ui-dialog-titlebar").attr("title",e);p.on("remove",b);F&&B.width(f).height(v);l(a);return p}function g(a){var b=VideoUtil.getVid(d.uid),k=N.width,f=N.height;Room.getOptions().interview?VideoUtil.setPos(p,VideoUtil.getPos()):p.dialog("instance")&&
p.dialog("option","width",k).dialog("option","height",f);!F||n||L||VideoUtil.setPos(p,VideoUtil.getPos(VideoUtil.getRects(VIDWIN_SEL),d.width,d.height+25));a.video=$(F?"\x3cvideo\x3e":"\x3caudio\x3e").attr("id","vid"+b).attr("playsinline","playsinline").prop("controls",!1).width(B.width()).height(B.height());a.data&&a.video.data(a.data);F?(B.removeClass("audio-only").css("background-image",""),B.parents(".ui-dialog").removeClass("audio-only"),a.video.attr("poster",d.user.pictureUri)):B.addClass("audio-only");
B.append(a.video);VideoUtil.hasMic(d)?(a=I.create(c),F?p.parent().find(".buttonpane").append(a):(a.addClass("ulist-small"),a.insertAfter("#user"+d.cuid+" .typing-activity"))):I.destroy()}function l(a){a=a||{iceServers:O,instanceUid:0<p.length?p.data("instance-uid"):void 0};d.self&&VideoManager.sendMessage({id:"broadcastRestarted",uid:d.uid});b();var c=VideoUtil.hasMic(d),e={disposed:!1,data:{}};t.push(e);d.self?n||L?u(a,e,w):q(a,e,w):h(a,e);y(c)}function D(){Room.hasRight(["MUTE_OTHERS"])&&VideoUtil.hasMic(d)?
z.addClass("enabled").off().click(function(){VideoManager.clickMuteOthers(d.cuid)}):z.removeClass("enabled").off()}function b(a){OmUtil.log("!!Disposing participant "+d.uid);for(var b;b=t.pop();){b.disposed=!0;b.options&&(delete b.options.videoStream,delete b.options.mediaConstraints,delete b.options.onicecandidate,delete b.options.localVideo,b.options=null);var c=b.data;if(c){c.analyser&&(VideoUtil.disconnect(c.analyser),c.analyser=null);c.gainNode&&(VideoUtil.disconnect(c.gainNode),c.gainNode=null);
c.aSrc&&(VideoUtil.cleanStream(c.aSrc.mediaStream),VideoUtil.disconnect(c.aSrc),c.aSrc=null);c.aDest&&(VideoUtil.disconnect(c.aDest),c.aDest=null);if(c.aCtx){c.aCtx.destination&&VideoUtil.disconnect(c.aCtx.destination);if("closed"!==c.aCtx.state)try{c.aCtx.close()}catch(f){console.error(f)}c.aCtx=null}VideoUtil.cleanPeer(c.rtcPeer);c.rtcPeer=null}VideoUtil.cleanStream(b.localStream);VideoUtil.cleanStream(b.stream);b.data=null;b.localStream=null;b.stream=null;(c=b.video)&&0<c.length&&(c.attr("id",
"dummy"),c=c[0],VideoUtil.cleanStream(c.srcObject),c.srcObject=null,c.load(),c.removeAttribute("src"),c.removeAttribute("srcObject"),c.parentNode.removeChild(c),b.video.data({}),b.video=null)}J&&0<J.length&&(e(!1),J.hide(),z.removeClass("enabled").off());M&&(M.dispose(),M=null);B.find("audio,video").remove();I.destroy();a&&a.target&&$(a).off()}var c={},t=[],G=window.AudioContext||window.webkitAudioContext,d,p,B,K,E,N,I,O,J,M,P=!1,z,F,n,L;c.update=function(a){var c=d.activities,e=d.width,f=d.height,
v=d.cam,t=d.mic;d.activities=a.activities.sort();d.level=a.level;d.user.firstName=a.user.firstName;d.user.lastName=a.user.lastName;d.user.displayName=a.user.displayName;d.width=a.width;d.height=a.height;d.cam=a.cam;d.mic=a.mic;a=d.user.displayName;F&&p.dialog("option","title",a).parent().find(".ui-dialog-titlebar").attr("title",a);c=c.length===d.activities.length&&c.every(function(a,f){return a===d.activities[f]})&&e===d.width&&f===d.height&&v==d.cam&&t===d.mic;d.self&&!c&&(b(),p.remove(),x({stream:d,
iceServers:O}))};c.refresh=l;c.mute=function(a){I.mute(a)};c.isMuted=function(){return I.muted()};c.init=x;c.stream=function(){return d};c.setRights=D;c.processSdpAnswer=function(b){var c=0<t.length?t[0]:null;c&&!c.disposed&&c.data.rtcPeer&&!c.data.rtcPeer.cleaned&&c.data.rtcPeer.processAnswer(b,function(b){if(!0!==this.cleaned){var f=a(c);"stable"===this.peerConnection.signalingState&&f&&f.paused?f.play().catch(function(a){"NotAllowedError"===a.name&&VideoUtil.askPermission(function(){f.play()})}):
b&&OmUtil.error(b,!0)}})};c.processIceCandidate=function(a){var b=0<t.length?t[0]:null;b&&!b.disposed&&b.data.rtcPeer&&!b.data.rtcPeer.cleaned&&b.data.rtcPeer.addIceCandidate(a,function(a){!0!==this.cleaned&&a&&OmUtil.error("Error adding candidate: "+a,!0)})};c.onIceCandidate=function(a){var b=Room.getOptions();OmUtil.log("Local candidate "+JSON.stringify(a));VideoManager.sendMessage({id:"onIceCandidate",candidate:a,uid:d.uid,luid:d.self?d.uid:b.uid})};c.reattachStream=function(){t.forEach(function(a){if(a.video&&
0<a.video.length){var b=a.data;a=a.video[0];!b.rtcPeer||a.srcObject&&a.srcObject.active||(a.srcObject=d.self?b.rtcPeer.getLocalStream():b.rtcPeer.getRemoteStream())}})};c.video=function(a){a=a||(0<t.length?t[0]:null);return!a||a.disposed?null:a.video};c.handleMicStatus=y;return c},VideoManager=function(){function a(a){var b=$("#"+VideoUtil.getVid(a.uid)).data();b&&b.processSdpAnswer(a.sdpAnswer)}function e(a){var b=a.stream.uid;Array.isArray(a.cleanup)&&a.cleanup.forEach(function(a){C(a)});$("#"+
VideoUtil.getVid(b)).remove();Video().init(a);OmUtil.log(b+" registered in room")}function u(a){a=a.stream;var b=$("#"+VideoUtil.getVid(a.uid)).data();b&&(VideoUtil.isSharing(a)||VideoUtil.isRecording(a))&&(b.stream().activities=a.activities);Sharer.setShareState(VideoUtil.isSharing(a)?SHARE_STARTED:SHARE_STOPPED);Sharer.setRecState(VideoUtil.isRecording(a)?SHARE_STARTED:SHARE_STOPPED)}function q(a){var b=a.stream.uid;h($("#"+VideoUtil.getVid(b)));Video().init(a);OmUtil.log(b+" receiving video")}
function m(b){switch(b.id){case "clientLeave":$(VID_SEL+'[data-client-uid\x3d"'+b.uid+'"]').each(function(){h($(this))});l.data("cuid")===b.uid&&l.off().hide();break;case "broadcastStopped":C(b.uid,!1);break;case "broadcast":e(b);break;case "videoResponse":a(b);break;case "iceCandidate":var c=$("#"+VideoUtil.getVid(b.uid)).data();c&&c.processIceCandidate(b.candidate);break;case "newStream":A([b.stream],b.iceServers);break;case "shareUpdated":u(b);break;case "error":OmUtil.error(b.message)}}function w(a,
c){try{if(!(c instanceof Blob)){var b=JSON.parse(c);if(b)if("kurento"===b.type&&"test"!==b.mode)OmUtil.info("Received message: "+c),m(b);else if("mic"===b.type)switch(b.id){case "activity":var e=b.uid,d=b.active,g=$("#user"+e+" .audio-activity"),h=x(e).parent();d?(g.addClass("speaking"),h.addClass("user-speaks")):(g.removeClass("speaking"),h.removeClass("user-speaks"))}}}catch(K){OmUtil.error(K)}}function h(a){!a||1>a.length||(void 0!==a.dialog("instance")&&a.dialog("destroy"),a.parents(".pod").remove(),
a.remove(),WbArea.updateAreaClass())}function y(a,c){c={stream:a,iceServers:c};a=$("#"+VideoUtil.getVid(a.uid));1===a.length&&a.remove();a=Video().init(c);VideoUtil.setPos(a,{left:0,top:35})}function A(a,c){D&&a.forEach(function(a){var b={stream:a,iceServers:c};VideoUtil.isSharing(a)?(VideoUtil.highlight(l.attr("title",l.data("user")+" "+a.user.firstName+" "+a.user.lastName+" "+l.data("text")).data("uid",a.uid).data("cuid",a.cuid).show(),"btn-outline-warning",10),l.tooltip().off().click(function(){y(a,
c)}),!0===Room.getOptions().autoOpenSharing&&y(a,c)):VideoUtil.isRecording(a)||q(b)})}function C(a,c){var b=$("#"+VideoUtil.getVid(a));1===b.length&&h(b);c||a!==l.data("uid")||l.off().hide()}function x(a){return $(VID_SEL+'[data-client-uid\x3d"'+a+'"][data-client-type\x3d"WEBCAM"]')}var g={},l,D=!1;g.init=function(){Wicket.Event.subscribe("/websocket/message",w);VideoSettings.init(Room.getOptions());l=$(".room-block .room-container").find(".btn.shared");D=!0};g.update=function(a){if(D){var b={};a.streams.forEach(function(c){b[c.uid]=
c.uid;c.self=a.self;c.cam=a.cam;c.mic=a.mic;if(!VideoUtil.isSharing(c)&&!VideoUtil.isRecording(c)){var e=VideoUtil.getVid(c.uid),d=VideoUtil.hasMic(c)||VideoUtil.hasCam(c),e=$("#"+e);d&&1===e.length?e.data().update(c):d||1!==e.length||h(e)}});a.uid===Room.getOptions().uid&&$(VID_SEL).each(function(){$(this).data().setRights(a.rights)});$('[data-client-uid\x3d"'+a.cuid+'"]').each(function(){var a=$(this).data().stream();b[a.uid]||h($(this))})}};g.play=A;g.close=C;g.refresh=function(a,c){a=x(a);0<a.length&&
a.data().refresh(c)};g.mute=function(a,c){a=x(a);0<a.length&&a.data().mute(c)};g.clickMuteOthers=function(a){var b=VideoSettings.load();if(!1!==b.video.confirmMuteOthers){var e=$("#muteothers-confirm");e.dialog({appendTo:".room-container",buttons:[{text:e.data("btn-ok"),click:function(){b.video.confirmMuteOthers=!$("#muteothers-confirm-dont-show").prop("checked");VideoSettings.save();OmUtil.roomAction({action:"muteOthers",uid:a});$(this).dialog("close")}},{text:e.data("btn-cancel"),click:function(){$(this).dialog("close")}}]})}else OmUtil.roomAction({action:"muteOthers",
uid:a})};g.muteOthers=function(a){$(VID_SEL).each(function(){var b=$(this),e=b.data(),b=b.data("client-uid");e&&b&&e.mute(a!==b)})};g.toggleActivity=function(a){g.sendMessage({id:"toggleActivity",activity:a})};g.sendMessage=function(a){OmUtil.sendMessage(a,{type:"kurento"})};g.destroy=function(){Wicket.Event.unsubscribe("/websocket/message",w)};return g}(),SHARE_STARTING="starting",SHARE_STARTED="started",SHARE_STOPPED="stopped",Sharer=function(){function a(a,b){a.prop("disabled",b);b?a.addClass("disabled"):
a.removeClass("disabled")}function e(e,b){var c=SHARE_STOPPED!==b,g=kurentoUtils.WebRtcPeer.browser,g=VideoUtil.isEdge(g)||VideoUtil.isChrome(g)||VideoUtil.isEdgeChromium(g);a(y,c);a(A,c||g);e.find("span").text(e.data(c?"stop":"start"));c?e.addClass("stop"):e.removeClass("stop");a(e,b===SHARE_STARTING);a(e,b===SHARE_STARTING)}function u(a){g=a;e(C,a)}function q(a){l=a;e(x,a)}function m(){var a=$('div[data-client-uid\x3d"'+Room.getOptions().uid+'"][data-client-type\x3d"SCREEN"]');return a&&a.data()&&
a.data().stream()?a.data().stream().uid:""}var w={},h,y,A,C,x,g=SHARE_STOPPED,l=SHARE_STOPPED;w.init=function(){l=g=SHARE_STOPPED;h=$("#sharer").dialog({classes:{"ui-dialog":"sharer","ui-dialog-titlebar":""},width:450,autoOpen:!1,resizable:!1});fixJQueryUIDialogTouch(h);if(VideoUtil.sharingSupported()){y=h.find("select.type");var e=kurentoUtils.WebRtcPeer.browser;A=h.find("select.fps");a(A,VideoUtil.isEdge(e));C=h.find(".share-start-stop").off().click(function(){g===SHARE_STOPPED?(u(SHARE_STARTING),
VideoManager.sendMessage({id:"wannaShare",shareType:y.val(),fps:A.val()})):VideoManager.sendMessage({id:"pauseSharing",uid:m()})});x=h.find(".record-start-stop").off();Room.getOptions().allowRecording?x.show().click(function(){l===SHARE_STOPPED?(q(SHARE_STARTING),VideoManager.sendMessage({id:"wannaRecord",shareType:y.val(),fps:A.val()})):VideoManager.sendMessage({id:"stopRecord",uid:m()})}):x.hide()}else h.find(".container").remove(),h.find(".alert").show()};w.open=function(){h&&h.dialog("instance")&&
h.dialog("open")};w.close=function(){h&&h.dialog("instance")&&h.dialog("close")};w.setShareState=u;w.setRecState=q;w.baseConstraints=function(a){return{video:{frameRate:{ideal:a.fps}},audio:!1}};return w}(),Room=function(){function a(a){var f=r.find("i").removeClass("icon-dock icon-undock");a?(f.addClass("icon-undock"),r.attr("title",r.data("ttl-undock")).find(".sr-only").text(r.data("ttl-undock")),C()):(f.addClass("icon-dock"),r.attr("title",r.data("ttl-dock")).find(".sr-only").text(r.data("ttl-dock")),
k.addClass("closed").resizable("destroy"))}function e(){var a=$(".video-container[data-client-type\x3dWEBCAM][data-client-uid\x3d"+Room.getOptions().uid+"]");return 0<a.length&&(a=a.first().data(),VideoUtil.hasMic(a.stream()))?a:null}function u(a){var f=$(a.target);if(!0!==a.target.isContentEditable&&!f.is("textarea, input:not([readonly]):not([type\x3dradio]):not([type\x3dcheckbox])")&&8===a.which)return a.preventDefault(),a.stopImmediatePropagation(),!1}function q(a,b){var f=OmUtil.getKeyCode(b);
return a.alt===b.altKey&&a.ctrl===b.ctrlKey&&a.shift===b.shiftKey&&a.code.toUpperCase()===(f?f.toUpperCase():"")}function m(a){if(q(n.keycode.arrange,a))VideoUtil.arrange();else if(q(n.keycode.arrangeresize,a))VideoUtil.arrangeResize();else if(q(n.keycode.muteothers,a))null!==e()&&VideoManager.clickMuteOthers(Room.getOptions().uid);else if(q(n.keycode.mute,a)){var f=e();null!==f&&f.mute(!f.isMuted())}else q(n.keycode.quickpoll,a)&&quickPollAction("open");27===a.which&&$("#wb-rename-menu").hide()}
function w(a){1===a.which&&$("#wb-rename-menu").hide()}function h(){void 0===k&&(k=$(".room-block .sidebar"));var a=void 0===k?0:k.width()+parseInt(k.css(F)),b=$(".room-block");$(".main.room")[0].style.setProperty("--sidebar-width",a+"px");285<a?b.addClass("big").removeClass("narrow"):b.removeClass("big").addClass("narrow")}function y(){n&&n.reloadUrl?window.location.href=n.reloadUrl:window.location.reload()}function A(){x();$(".room-block").remove();$("#chatPanel").remove();$("#disconnected-dlg").modal("show").off("hide.bs.modal").on("hide.bs.modal",
y)}function C(){k.resizable({handles:Settings.isRtl?"w":"e",stop:function(){h()}})}function x(){$("body").removeClass("no-header");Wicket.Event.unsubscribe("/websocket/closed",A);Wicket.Event.unsubscribe("/websocket/error",A);"object"===typeof WbArea&&(WbArea.destroy(),window.WbArea=void 0);"object"===typeof VideoSettings&&VideoSettings.close();"object"===typeof VideoManager&&VideoManager.destroy();$(".ui-dialog.user-video").remove();$(window).off("keyup.openmeetings");$(window).off("keydown.openmeetings");
$(window).off("keydown.om-sip");$(window).off("keyup.om-sip");$(document).off("click",w);k=void 0;Sharer.close();H&&(H.disable(),H=null)}function g(a,b){b=b||n.rights;if(!Array.isArray(a)){if("SUPER_MODERATOR"===a)return b.includes(a);a=[a]}a=[].concat(["SUPER_MODERATOR","MODERATOR"],$jscomp.arrayFromIterable(a));for(var f=0;f<a.length;++f)if(b.includes(a[f]))return!0;return!1}function l(){var a=$("#quick-vote .close-btn");1===a.length&&(g(["PRESENTER"])?(a.show(),"object"!==typeof a.data("bs.confirmation")&&
a.confirmation({confirmationEvent:"bla",onConfirm:function(){quickPollAction("close")}})):a.hide())}function D(a,b,c,d,e){a=a.find(b);c()?(a.show(),c=d(),e()?a.addClass("disabled"):(a.removeClass("disabled"),c?a.addClass("enabled"):a.removeClass("enabled")),a.attr("title",a.data(c?"on":"off"))):a.hide()}function b(a,b,c,d,e){var f=a.find(b);c()?(0===f.length&&(f=OmUtil.tmpl("#user-actions-stub "+b),a.append(f)),f.off(),e?(f.confirmation("dispose"),f.confirmation(e)):f.click(d)):f.hide()}function c(a,
b,c,d,e){var f=a.uid===n.uid,v=g(c,a.rights),h=b.find(d);e()&&!g("SUPER_MODERATOR",a.rights)&&(f&&n.questions&&!v||!f&&g("MODERATOR"))?(0===h.length&&(h=OmUtil.tmpl("#user-actions-stub "+d),b.append(h)),v?h.addClass("granted"):h.removeClass("granted"),h.attr("title",h.data(f?"request":v?"revoke":"grant")),h.off().click(function(){OmUtil.roomAction({action:"toggleRight",right:c[0],uid:a.uid})})):h.remove()}function t(a,b){c(a,b,["AUDIO"],".right.audio",function(){return!0})}function G(a,b){c(a,b,["VIDEO"],
".right.camera",function(){return!n.audioOnly})}function d(a,b){c(a,b,["PRESENTER"],".right.presenter",function(){return!n.interview&&$(".wb-area").is(":visible")});c(a,b,["WHITEBOARD","PRESENTER"],".right.wb",function(){return!n.interview&&$(".wb-area").is(":visible")});c(a,b,["SHARE"],".right.screen-share",function(){return!0});c(a,b,["REMOTE_CONTROL"],".right.remote-control",function(){return!0});c(a,b,["MODERATOR"],".right.moderator",function(){return!0})}function p(a,b){var f=b.find(".user-status"),
c=5==a.level?"mod":3==a.level?"wb":"user";f.removeClass("mod wb user");f.attr("title",f.data(c)).addClass(c);b.data("level",a.level)}function B(){$("#room-sidebar-users-tab .user-count").text($("#room-sidebar-tab-users .user-list .users .user.entry").length)}function K(){var a=$("#room-sidebar-tab-users .user-list .users");a.find(".user.entry").sort(function(a,b){a=$(a);b=$(b);return b.data("level")-a.data("level")||a.attr("title").localeCompare(b.attr("title"))}).appendTo(a)}function E(a){if(n){var f=
a.uid===n.uid,c=Room.getClient(a.uid),e=VideoUtil.hasMic(a),h=VideoUtil.hasCam(a),k=c.find(".audio-activity");0!==c.length&&(p(a,c),h||e?0===c.find(".restart").length&&c.prepend(OmUtil.tmpl("#user-av-restart").click(function(){VideoManager.refresh(a.uid)})):c.find(".restart").remove(),k.hide().removeClass("clickable").attr("title",k.data("speaks")).off(),e&&(k.show(),g("MUTE_OTHERS")&&k.addClass("clickable").click(function(){VideoManager.clickMuteOthers(a.uid)}).attr("title",k.attr("title")+k.data("mute"))),
c.attr("title",a.user.displayName).css("background-image","url("+a.user.pictureUri+")").find(".user.name").text(a.user.displayName),c=c.find(".user.actions"),G(a,c),t(a,c),d(a,c),b(c,".kick",function(){return!f&&g("MODERATOR")&&!g("SUPER_MODERATOR",a.rights)},null,{confirmationEvent:"om-kick",placement:Settings.isRtl?"left":"right",onConfirm:function(){return OmUtil.roomAction({action:"kick",uid:a.uid})}}),b(c,".private-chat",function(){return n.userId!==a.user.id&&$("#chatPanel").is(":visible")},
function(){Chat.addTab("chatTab-u"+a.user.id,a.user.displayName);Chat.open();$("#chatMessage .wysiwyg-editor").click()}),f&&(n.rights=a.rights,l(),n.activities=a.activities,c=$("#room-sidebar-tab-users .header"),G(a,c),D(c,".activity.cam",function(){return!n.audioOnly&&g("VIDEO")},function(){return h},function(){return 0>Settings.load().video.cam}),t(a,c),D(c,".activity.mic",function(){return g("AUDIO")},function(){return e},function(){return 0>Settings.load().video.mic}),d(a,c)),VideoManager.update(a))}}
function N(a){var b=$(".sip-number");b.val(b.val()+a)}function I(){var a=$(".sip-number"),b=a.val();b&&a.val(b.substring(0,b.length-1))}function O(){$(".sip .button-row button").off().click(function(){N($(this).data("value"))});$("#sip-dialer-btn-erase").off().click(I)}function J(a){var b=-1;47<a.keyCode&&58>a.keyCode&&(b=a.keyCode-48);95<a.keyCode&&106>a.keyCode&&(b=a.keyCode-96);return b}function M(a){a=J(a);0<a&&$("#sip-dialer-btn-"+a).addClass("bg-warning")}function P(a){"Backspace"===a.key?I():
(a=J(a),0<a&&($("#sip-dialer-btn-"+a).removeClass("bg-warning"),N(a)))}var z={},F=Settings.isRtl?"right":"left",n,L,k,r,H;$.extend($.ui.dialog.prototype.options.classes,{"ui-dialog":"modal-content","ui-dialog-titlebar":"modal-header","ui-dialog-title":"modal-title","ui-dialog-titlebar-close":"close","ui-dialog-content":"modal-body","ui-dialog-buttonpane":"modal-footer"});$.extend($.ui.button.prototype.options.classes,{"ui-button":"btn btn-outline-secondary"});z.init=function(b){n=b;window.WbArea=
n.interview?InterviewWbArea():DrawWbArea();b=$(".room-block .room-container .menu");$("#activities");k=$(".room-block .sidebar");k.width(k.width());r=k.find(".btn-dock").click(function(){var b=parseInt(k.css(F));0>b&&k.removeClass("closed");r.prop("disabled",!0);var c={};c[F]=0>b?"0px":-k.width()+45+"px";k.animate(c,1500,function(){r.prop("disabled",!1);a(0>b);h()})});a(!0);var c=$("#room-sidebar-tab-users .header");c.find(".om-icon.settings").off().click(VideoSettings.open);c.find(".om-icon.activity.cam").off().click(function(){VideoManager.toggleActivity("VIDEO")});
c.find(".om-icon.activity.mic").off().click(function(){VideoManager.toggleActivity("AUDIO")});L=0===b.length?0:b.height();VideoManager.init();"undefined"!==typeof Activities&&Activities.init();Sharer.init();h()};z.getMenuHeight=function(){return L};z.getOptions=function(){return"object"===typeof n?JSON.parse(JSON.stringify(n)):{}};z.load=function(){$("body").addClass("no-header");Wicket.Event.subscribe("/websocket/closed",A);Wicket.Event.subscribe("/websocket/error",A);$(window).on("keydown.openmeetings",
u);$(window).on("keyup.openmeetings",m);$(window).on("keydown.om-sip",M);$(window).on("keyup.om-sip",P);$(document).click(w);H&&(H.disable(),H=null);H=new NoSleep;H.enable();O()};z.unload=x;z.showClipboard=function(a){var b=$("#clipboard-dialog");b.find("p .text").text(a);b.dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:[{text:b.data("btn-ok"),click:function(){$(this).dialog("close")}}]})};z.quickPoll=function(a){if(a.started){var b=$("#quick-vote");if(0===b.length){var c=$(".room-block .wb-block"),
b=OmUtil.tmpl("#quick-vote-template","quick-vote");c.append(b)}c=b.find(".control.pro");b=b.find(".control.con");a.voted?(c.removeClass("clickable").off(),b.removeClass("clickable").off()):(c.addClass("clickable").off().click(function(){quickPollAction("vote",!0)}),b.addClass("clickable").off().click(function(){quickPollAction("vote",!1)}));c.find(".badge").text(a.pros);b.find(".badge").text(a.cons);l()}else a=$("#quick-vote"),1===a.length&&a.remove();OmUtil.tmpl("#quick-vote-template","quick-vote")};
z.hasRight=g;z.setCssVar=function(a,b){$(".main.room")[0].style.setProperty(a,b)};z.addClient=function(a){n&&((Array.isArray(a)?a:[a]).forEach(function(a){var b=a.uid===n.uid,c=Room.getClient(a.uid);0===c.length&&(c=OmUtil.tmpl("#user-entry-stub","user"+a.uid),c.attr("id","user"+a.uid).attr("data-userid",a.user.id).attr("data-uid",a.uid),b&&c.addClass("current"),$("#room-sidebar-tab-users .user-list .users").append(c));E(a)}),B(),K())};z.updateClient=function(a){E(a);K()};z.removeClient=function(a){Room.getClient(a).remove();
B()};z.removeOthers=function(){var a=Room.getOptions().uid;$(".user-list .user.entry").each(function(){var b=$(this);b.data("uid")!==a&&b.remove()});B()};z.getClient=function(a){return $("#user"+a)};return z}();function typingActivity(a,e){a=Room.getClient(a).find(".typing-activity");e?a.addClass("typing"):a.removeClass("typing")};